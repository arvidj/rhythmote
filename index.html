<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">

<!--

 Rhythmweb - a web site for your Rhythmbox.
 Copyright (C) 2007 Michael Gratton.

 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License along
 with this program; if not, write to the Free Software Foundation, Inc.,
 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

-->

<html>
<head>
<title>Rhythmote</title>
	<meta name="description" content="Rhythmbox web-based remote control">	
	<LINK REL="SHORTCUT ICON" HREF="favicon.ico">
	<link rel="stylesheet" type="text/css" media="screen" href="site.css" />
	<script type="text/javascript" src="jquery/jquery-1.3.2.min.js"></script>
	<link rel="stylesheet" type="text/css" media="screen" href="jquery/jquery-ui-1.7.1.custom/css/vader/jquery-ui-1.7.1.custom.css" /> 
	<script type="text/javascript" src="jquery/jquery-ui-1.7.1.custom/js/jquery-ui-1.7.1.custom.min.js"></script>

	<!--
	<link rel="stylesheet" type="text/css" media="screen" href="jquery/jqGrid-3.5.alfa/themes/lightness/ui.all.css" />
	-->

	<!--
	<link rel="stylesheet" type="text/css" media="screen" href="jquery/jqGrid-3.5.alfa/themes/ui.jqgrid.css" />
	<script src="jquery/jqGrid-3.5.alfa/js/jquery.jqGrid.js" type="text/javascript"></script>
	<script src="jquery/jqGrid-3.5.alfa/js/jquery.tablednd.js" type="text/javascript"></script>
	-->

	<!--
	<link rel="stylesheet" type="text/css" media="screen" href="jquery/jqGrid-3.5-beta/css/ui.jqgrid.css" />
	<script src="jquery/jqGrid-3.5-beta/jquery.jqGrid.js" type="text/javascript"></script>
	-->


	<link rel="stylesheet" type="text/css" media="screen" href="jquery/jqGrid-3.5.2/css/ui.jqgrid.css" />

	<script src="jquery/jqGrid-3.5.2/js/i18n/grid.locale-en.js" type="text/javascript"></script>
	<script src="jquery/jqGrid-3.5.2/js/jquery.jqGrid.min.js" type="text/javascript"></script>


	<!--
	<link rel="stylesheet" type="text/css" media="screen" href="jquery/jqGrid-3.4.2/themes/coffee/grid.css" /> 
	<script type="text/javascript" src="jquery/jqGrid-3.4.2/js/jqDnR.js"></script>
	<script type="text/javascript" src="jquery/jqGrid-3.4.2/jquery.jqGrid.js"></script>
	-->
	
	
	<!--
	<script src="jquery/cluetip-0.9.8/jquery.hoverIntent.js" type="text/javascript"></script>
	<script src="jquery/cluetip-0.9.8/jquery.cluetip.js" type="text/javascript"></script>	
	<link rel="stylesheet" href="jquery/cluetip-0.9.8/jquery.cluetip.css" type="text/css" />
	-->

	<script src="jquery/blockui/jquery.blockUI.js" type="text/javascript"></script>	

  <script type="text/javascript">
	var playminelp = 0;
	var playsecelp = 0;
	var playsecdur = 0;
	var pltmOut  = 0;
	var pltmUpdt = 0;
	var curTrackTime = '';
	var curVolume = 0;
	var docWidth = 0;
	$(function(){

			docWidth = $(document).width();
			$().ajaxStop(function(){$.unblockUI();$('#container').css("visibility","visible");}); 
			$.blockUI({ 
				message:'Loading music library, please wait...',
				css: 
				{
            			border: 'none', 
            			padding: '15px', 
            			backgroundColor: '#000', 
            			'-webkit-border-radius': '10px', 
            			'-moz-border-radius': '10px', 
            			opacity: '.5', 
            			color: '#fff' 
        			}
			 }); 
			//volume Slider
			make_volctrl();
			make_play_pos_ctrl();
	
				
			//hover states on the static widgets
			$('button#volumedown,button#volumeup,ul#icons button').hover(
				function() { $(this).addClass('ui-state-hover'); }, 
				function() { $(this).removeClass('ui-state-hover'); }
			);
		       

			$('#container').width(docWidth*.955);	
			$('#player-control-panel').width(docWidth*.95);	
			$('#volume_slider').width(docWidth*.2);
			$('#playing-info-panel').width(docWidth*.95);	
			$('#play_position_slider').width(docWidth*.95);		
			$("#play_queue_list").jqGrid({ url:'/get-xml-pl/', 
						  datatype: "xml", 
						  colNames:['Track#', 'Title', 'Artist','Album','Time','Genre','Track id'], 
						  colModel:[ {name:'id',index:'id', width:30, sortable:false}, 
							     {name:'title',index:'title', width:150}, 
							     {name:'artist',index:'artist', width:80, align:"left"}, 
							     {name:'album',index:'album', width:100, align:"left"}, 
							     {name:'time',index:'time', width:30,align:"center"}, 
							     {name:'genre',index:'genre', width:55},
							     {name:'trackid',index:'trackid',hidden:true} ], 
						  rowNum:-1,
						  postData:{action:'get-xml-pl'},
						  pginput:false,
					          pgtext:'',
						  loadonce:true,
						  rownumbers:true,
						  gridview:true,
						  recordpos:'center',
                                                  pgbuttons:false,
						  recordtext:'{1} Total Tracks',
						  rowList:[], 
						  imgpath: 'jquery/jqGrid-3.4.2/themes/coffee/images', 
						  pager: $('#play_queue_pager'), 
						  sortname: 'id', 
						  viewrecords: true, 
						  sortorder: "desc",
						  ondblClickRow:playtrack,
						  width:docWidth*.95,
						  height:'auto',
						  caption:"Music library",
						  gridComplete:function(){/*$.unblockUI();$('#container').css("visibility","visible");*/}
						});

		//$('#volumeup').click(volume_up);
		//$('#volumedown').click(volume_down);
		get_playing();
	});

	function make_volctrl(){
          $.post('/',{action:'get-vol'},function(data){
		var obj = eval('('+data+')');
		curVolume = obj.current_vol;
		$('#volume_slider').slider({min:0,
						   max:1,
						   step:0.1,
						   value:obj.current_vol,
						   /*orientation: 'vertical',*/
						   slide:function(event, ui) { 
							curVolume = ui.value;
							setvolume(ui.value);
						   }
		});
	   });
	}

	function set_play_pos(pos){
          $.post('/',{action:'set-play-time',pos:pos},function(data){
		get_playing();
	   });
	}

	function make_play_pos_ctrl(){
		$('#play_position_slider').slider({min:0,
						   max:1,
						   step:1,
						   value:0,
						   change:function(event, ui) { 
							set_play_pos(ui.value);
						   }
		});
	}

       


	function setvolume(volume){
          $.post('/',{action:'set-vol',vol:volume},function(data){
		
	   });
	}

	function volume_up(){
	   curVolume = $('#volume_slider').slider('option','value');
	   if(curVolume+0.1<=1){		
	   	$('#volume_slider').slider('option','value',curVolume+0.1);
		setvolume(curVolume+0.1);
		
	   }
	}

	function volume_down(){
	   curVolume = $('#volume_slider').slider('option','value');
	   if(curVolume-0.1>=0){		
                $('#volume_slider').slider('option','value',curVolume-0.1);
		setvolume(curVolume-0.1);
	   }
	}

	function playtrack(rowid){
	  row = $('#play_queue_list').getRowData(rowid);
          $.post('/',{action:'play-entry',location:row.trackid},function(data){
	     	if(pltmOut != 0)
	  		clearTimeout(pltmOut);
		pltmOut  = setTimeout('get_playing()',1500);
	   });
	}
	function play_next(){
          $.post('/',{action:'next'},function(data){
	     	if(pltmOut != 0)
	  		clearTimeout(pltmOut);
		pltmOut  = setTimeout('get_playing()',1500);
	   });
	}
	function play_prev(){
          $.post('/',{action:'prev'},function(data){
	     	if(pltmOut != 0)
	  		clearTimeout(pltmOut);
		pltmOut  = setTimeout('get_playing()',1500);
	   });
	}

	function toggle_play(){
          $.post('/',{action:'play',location:1},function(data){
		var obj = eval('('+data+')');
		if(obj.pause){
		  $('#playbtn span').removeClass('ui-icon-play');
		  $('#playbtn span').addClass('ui-icon-pause');

	     	  if(pltmUpdt != 0)
	  		clearInterval(pltmUpdt);
	     	  if(pltmOut != 0)
	  		clearTimeout(pltmOut);
		}
		else{ 
		  $('#playbtn span').removeClass('ui-icon-pause');
		  $('#playbtn span').addClass('ui-icon-play');
	     	  if(pltmUpdt != 0)
	  		clearInterval(pltmUpdt);
	     	  if(pltmOut != 0)
	  		clearTimeout(pltmOut);

		  pltmOut  = setTimeout('get_playing()',1500);
		}
	   });
	}

	function get_playing(){
	     if(pltmOut != 0)
	  clearTimeout(pltmOut);

	     if(pltmUpdt != 0)
	  clearInterval(pltmUpdt);

          $.post('/',{action:'get-playing'},function(data){		
		$('#playing-info').html(data);
		if($('#elp-sec-count') != null){
			playsecelp = $('#elp-sec-count').html();
			playsecdur = $('#dur-sec-count').html();
			curTrackTime = Math.floor(playsecdur/60)+":"+((playsecdur%60)<10?'0'+(playsecdur%60):(playsecdur%60));

			$('#play_position_slider').slider('option','max',playsecdur).slider('option','value',playsecelp);


			tmout = (playsecdur-playsecelp)+2;
			pltmOut  = setTimeout('get_playing()',tmout*1000);
			pltmUpdt = setInterval("show_play_time()",1000);	
			
		}
	   });
	}

	function show_play_time(){
	  ++playsecelp;
	  if(playsecelp>=playsecdur)
		clearInterval(pltmUpdt);
	  else{
		$('#current-play-time').
		html(Math.floor(playsecelp/60)+":"+((playsecelp%60)<10?'0'+(playsecelp%60):(playsecelp%60))+' of '+curTrackTime);
		$('#play_position_slider').slider('option','value',playsecelp);
	  }
	}
  </script>
		<style type="text/css">		
			ul#icons {margin: 0; padding: 0;}
			ul#icons li {margin: 2px; position: relative; padding: 4px 0; cursor: pointer; float: left;  list-style: none;}
			ul#icons span.ui-icon {float: left; margin: 0 4px;}
			#container {margin-left:auto;margin-right:auto;padding-top:5px}
			#floating-control-panel {position:fixed;left:auto;top:5px;bottom:auto;z-index:100;clear:both}
		</style>	
<META http-equiv="Pragma" content="no-cache">
</head>
	<body>	   
	   <div id="container" style="visibility:hidden;">

	     <div class="ui-state-default ui-corner-all" id="floating-control-panel">
	      <div id="player-control-panel">
		<div style="width:49.5%;float:left">
		<ul id="icons" class="ui-widget ui-helper-clearfix">
		
			<li>
				<button onclick="toggle_play()" id="playbtn" class="ui-state-default ui-corner-all" title="Play">
				 <span class="ui-icon ui-icon-play"></span>
				</button>
			</li>
			<li>
				<button onclick="play_prev()" class="ui-state-default ui-corner-all" title="Previous">
				 <span class="ui-icon ui-icon-seek-prev"></span>
				</button>
			</li>
			<li>
				<button onclick="play_next()" class="ui-state-default ui-corner-all" title="Next">
				 <span class="ui-icon ui-icon-seek-next"></span>
				</button>
			</li>
		</ul>
		</div>
		<div style="width:49.5%;float:left;text-align:right;">
		   <table>
			<tr>
				<td><span class="ui-icon ui-icon-volume-on"></span></td>
				<td><button id="volumedown" onclick="volume_down()" class=" ui-state-default ui-corner-all"><span class="ui-icon ui-icon-minus"></span></button></td>
				<td><div id="volume_slider"></div></td>
				<td><button id="volumeup" onclick="volume_up()" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-plus"></span></button></td>
			</tr>
		   </table>
		</div>
	      </div>

		<div id="playing-info-panel" style="clear:both;padding-top:5px;padding-bottom:5px">
		    <table style="width:100%">
			<tr>
				<td style="width:85%"><span id="playing-info">&nbsp;</span></td>
				<td id="current-play-time" style="width:10%;text-align:right;"></td>
			</tr>
		    </table>
		</div>

		<div id="play_position_slider"></div><br/>
	     </div>

	     <div style="margin-top:105px;">
	       <table id="play_queue_list" class="scroll" cellpadding="0" cellspacing="0"></table>
	       <div id="play_queue_pager" class="scroll" style="text-align:center;"></div> 
	     </div>
	   </div>
	</body>
</html>
